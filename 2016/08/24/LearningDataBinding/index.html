<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="在这里将会呈现的是我从 Android 官网、实际开发项目的实践及其他人的实践所学习的关于 Data Binding 的知识。 创建这个 repository 之时，我已经在O2O、B2C、股票投资等类型的上线项目或个人项目中使用了 Data Binding，并且在今后的商业项目中继续使用。
前言A">
    

    <!--Author-->
    
        <meta name="author" content="Knox Cho">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="LearningDataBinding"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="KNOX"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

        <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>LearningDataBinding - KNOX</title>

    <!-- Bootstrap Core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    


</head>


<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Knox's Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="/">
                            
                                Home
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives">
                            
                                Archives
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('https://images.unsplash.com/photo-1463123081488-789f998ac9c4?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&s=6d1a6d1c5a7eb63d0c411b1d019f0b30')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>LearningDataBinding</h1>
                    
                    <span class="meta">
                        <!-- Date and Author -->
                        
                        2016-08-24
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Tags and categories -->
           

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <p>在这里将会呈现的是我从 <a href="https://developer.android.com/topic/libraries/data-binding/index.html" target="_blank" rel="external">Android</a> 官网、实际开发项目的实践及其他人的实践所学习的关于 Data Binding 的知识。 创建这个 repository 之时，我已经在O2O、B2C、股票投资等类型的上线项目或个人项目中使用了 Data Binding，并且在今后的商业项目中继续使用。</p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Android 的 Data Binding(数据绑定) 在 Google 的 2015 I/O 上推出，目的在于将逻辑代码和 UI 布局代码更好地绑定在一起，减少 glue code，例如消灭 <code>findViewById()</code>，自动刷新数据等。Data Binding 支持 API 7+。在 2016 I/O 上 android 官方宣布支持双向绑定，因此可以也利用 Data Binding 在 android 项目中实现 MVVM 架构。</p>
<p>####优点：</p>
<ol>
<li>保证 xml 内的代码始终在 UI 线程执行，不必担心线程切换的问题。</li>
<li>减少在业务逻辑中与 View 的交互，例如 setText(), setImageResource(), etc…</li>
<li>性能佳，因为 Data Binding 的一切都发生在编译时，零反射。</li>
</ol>
<p>####缺点</p>
<ol>
<li>因为是在编译时产生代码，所以会适当增加编译时间。</li>
<li>IDE 的智能提示有限，比如在自定义的 attribute 里面目前无法提示。</li>
<li>增加调试难度，一个地方写错代码将导致其他 layout 的 binding 出错，出错信息比较隐晦，不过随着版本更新，这个问题在逐步解决。</li>
</ol>
<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><ol>
<li>Android Plugin for Gradle 的版本需为 <code>1.5.0-alpha1</code> 或以上，以及相应版本的 Android Studio。</li>
<li>在 Application module 的 <code>build.gradle</code> 文件加入一下代码：<pre>android {
   dataBinding {
        enabled = true
     }
}
</pre></li>
<li>可以开始写代码了。</li>
</ol>
<h2 id="使用前"><a href="#使用前" class="headerlink" title="使用前"></a>使用前</h2><ol>
<li>将<code>&lt;layout&gt; &lt;/layout&gt;</code> 包裹在布局文件中的根布局外。</li>
<li>在 gradle plugin 2.2 版本之前需要 Make 或 Build 项目才能使用了，不过在 2.2 之后写了 <code>&lt;layout&gt;&lt;/layout&gt;</code> 即可使用。</li>
</ol>
<h2 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h2><p>1.在 Activity 中初始化：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">    DataBindingUtil.setContentView(layoutId, <span class="keyword">this</span>);</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>这就相当于 setContextView() ，这个方法返回的是相应的 xml 文件或动态生成的 java 文件，里面包含了所有 view 的实例，可供直接使用而不再需要 findViewById(), 这里说的 view 实例指的是在 xml 文件里面写了 id 的 view，不写 id 是不会拿到 view 实例的.<br> 在 activity 中实例的方法还有:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">    View view = LayoutInflater.from(<span class="keyword">this</span>).inflate(layoutId, <span class="keyword">null</span>);  </div><div class="line">    ActivityBinding.bind(view);</div><div class="line">  &#125;</div><div class="line">```  </div><div class="line">同样的，这个 bind() 方法也是相应的 xml 文件或返回 java 文件。  </div><div class="line">一般来说，按照以上配置的 binding 是指向相应的 xml 文件，不过以 apt 的方式去编译资源文件就可以得到相应的 java 文件，即在 <span class="keyword">module</span> 的 build 文件顶部加入`apply plugin: <span class="string">'com.neenbedankt.android-apt'</span>`和在 root 的 build 文件里面的 dependencies 加入 `classpath <span class="string">'com.neenbedankt.gradle.plugins:android-apt:1.8'</span>`, 这样生成的 binding 文件就是 java 文件。    </div><div class="line"></div><div class="line"><span class="number">2</span>.在 Fragment 中初始化：  </div><div class="line">``` java</div><div class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container,</span></span></div><div class="line">      Bundle savedInstanceState) &#123;</div><div class="line">        FragmentBinding binding = FragmentBinding.inflate(inflater,container, <span class="keyword">false</span>);  </div><div class="line">        <span class="keyword">return</span> binding.getRoot();</div><div class="line">&#125;</div><div class="line">```  </div><div class="line">同样的，该方法指向相应的 xml 文件或相应的 java 文件，同时，在 fragment 中初始化还有以下方法：  </div><div class="line">``` java</div><div class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container,</span></span></div><div class="line">      Bundle savedInstanceState) &#123;</div><div class="line">        View view = inflater.from(<span class="keyword">this</span>).inflate(layoutId, <span class="keyword">null</span>);</div><div class="line">        FragmentBinding.bind(view);</div><div class="line">        <span class="keyword">return</span> view;</div><div class="line">      &#125;</div></pre></td></tr></table></figure></p>
<p>Activity 的初始化使用到了 DataBindingUtil 的 setContentView 方法：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends ViewDataBinding&gt; <span class="function">T <span class="title">setContentView</span><span class="params">(Activity activity, <span class="keyword">int</span> layoutId)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> setContentView(activity, layoutId, sDefaultComponent);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends ViewDataBinding&gt; <span class="function">T <span class="title">setContentView</span><span class="params">(Activity activity, <span class="keyword">int</span> layoutId,</span></span></div><div class="line">            DataBindingComponent bindingComponent) &#123;</div><div class="line">        activity.setContentView(layoutId);</div><div class="line">        View decorView = activity.getWindow().getDecorView();</div><div class="line">        ViewGroup contentView = (ViewGroup) decorView.findViewById(android.R.id.content);</div><div class="line">        <span class="keyword">return</span> bindToAddedViews(bindingComponent, contentView, <span class="number">0</span>, layoutId);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> &lt;T extends ViewDataBinding&gt; <span class="function">T <span class="title">bindToAddedViews</span><span class="params">(DataBindingComponent component,</span></span></div><div class="line">            ViewGroup parent, <span class="keyword">int</span> startChildren, <span class="keyword">int</span> layoutId) &#123;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> endChildren = parent.getChildCount();</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> childrenAdded = endChildren - startChildren;</div><div class="line">        <span class="keyword">if</span> (childrenAdded == <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">final</span> View childView = parent.getChildAt(endChildren - <span class="number">1</span>);</div><div class="line">            <span class="keyword">return</span> bind(component, childView, layoutId);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">final</span> View[] children = <span class="keyword">new</span> View[childrenAdded];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; childrenAdded; i++) &#123;</div><div class="line">                children[i] = parent.getChildAt(i + startChildren);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> bind(component, children, layoutId);</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>当然还有 bind(), infalte(), bindTo() 等方法可以用来绑定布局，不局限在 Acitivty 或 Fragment 中使用，不过在我的实践中发现，Data Binding 还不能很好支持自定义控件的绑定，还是需要使用传统的方式，例如 findViewById, 不过这个情况应该会在以后得到更好的支持，Data Binding 还会带来更多惊喜。</p>
<h2 id="单向绑定"><a href="#单向绑定" class="headerlink" title="单向绑定"></a>单向绑定</h2><h3 id="向布局文件绑定一个对象"><a href="#向布局文件绑定一个对象" class="headerlink" title="向布局文件绑定一个对象"></a>向布局文件绑定一个对象</h3><p>创建一个 User 对象，在 xml 中加入一下示例代码：<br>   <figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&lt;data&gt;</div><div class="line">  &lt;variable</div><div class="line">    name="user"</div><div class="line">    type="me.knox.learningdatabinding.User"</div><div class="line">&lt;/data&gt;</div><div class="line">   &lt;TextView</div><div class="line">      android:layout_width="wrap_content"</div><div class="line">      android:layout_height="wrap_content"</div><div class="line">      android:text="@&#123;user.name&#125;"</div><div class="line">      /&gt;</div><div class="line">  &lt;TextView</div><div class="line">      android:layout_width="wrap_content"</div><div class="line">      android:layout_height="wrap_content"</div><div class="line">      android:text="@&#123;user.gender&#125;"</div><div class="line">      /&gt;</div><div class="line">  &lt;TextView</div><div class="line">      android:layout_width="wrap_content"</div><div class="line">      android:layout_height="wrap_content"</div><div class="line">      android:text="@&#123;user.age&#125;"</div><div class="line">      /&gt;</div></pre></td></tr></table></figure></p>
<p>   就这样，即使控件没有 id 可以引用，只要往 xml 赋值一个 User，这三个 TextView 就会自动显示设置的内容。<br>   在 Activity 或 Fragment 中赋值。这时，binding 文件已经生成了 setUser() 方法，只要在适当的时候调用这个 setUser() 方法即可，例如 binding.setUser(user)。  </p>
<h3 id="控件监听绑定"><a href="#控件监听绑定" class="headerlink" title="控件监听绑定"></a>控件监听绑定</h3><p>在 xml 中，加入如下代码：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">      <span class="attr">android:id</span>=<span class="string">"@+id/edt_title"</span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">      <span class="attr">android:hint</span>=<span class="string">"type in to see binding works"</span></div><div class="line">      /&gt;</div></pre></td></tr></table></figure></p>
<p>这样就可以在绑定的布局实例中找到这个 EditText 控件，一般为驼峰命名，如 edtTitle, 然后在 Activity 或 Fragment 中加入如下代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">binding.edtTitle.addTextChangedListener(<span class="keyword">new</span> TextWatcher() &#123;</div><div class="line">      <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeTextChanged</span><span class="params">(CharSequence charSequence, <span class="keyword">int</span> i, <span class="keyword">int</span> i1, <span class="keyword">int</span> i2)</span> </span>&#123;</div><div class="line"></div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTextChanged</span><span class="params">(CharSequence charSequence, <span class="keyword">int</span> i, <span class="keyword">int</span> i1, <span class="keyword">int</span> i2)</span> </span>&#123;</div><div class="line"></div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterTextChanged</span><span class="params">(Editable editable)</span> </span>&#123;</div><div class="line">        String s = editable.toString();</div><div class="line">        binding.tvTitle.setText(s);</div><div class="line">      &#125;</div><div class="line">    &#125;);</div></pre></td></tr></table></figure></p>
<p>在 Data Binding 中就是这样使用控件的实例，无需 findViewById()。</p>
<h3 id="列表数据绑定"><a href="#列表数据绑定" class="headerlink" title="列表数据绑定"></a>列表数据绑定</h3><p>这里使用 RecyclerView 来展示一个列表。<br>首先可以继承 <code>ViewDataBinding</code> 来写一个 ViewHolder 通用父类，更方便在项目中使用，代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataBoundViewHolder</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">ViewDataBinding</span>&gt; <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> T binding;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">DataBoundViewHolder</span><span class="params">(T binding)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>(binding.getRoot());</div><div class="line">    <span class="keyword">this</span>.binding = binding;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> T <span class="title">getBinding</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> binding;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后写一个 item_rv.xml:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">layout</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">data</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">variable</span></span></div><div class="line">        <span class="attr">name</span>=<span class="string">"user"</span></div><div class="line">        <span class="attr">type</span>=<span class="string">"me.knox.learningdatabinding.User"</span>/&gt;</div><div class="line">  <span class="tag">&lt;/<span class="name">data</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:padding</span>=<span class="string">"10dp"</span>&gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">      <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></div><div class="line">      <span class="attr">android:text</span>=<span class="string">"@&#123;user.name&#125;"</span></div><div class="line">      <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">      /&gt;</div><div class="line">  <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">      <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></div><div class="line">      <span class="attr">android:text</span>=<span class="string">"@&#123;user.gender&#125;"</span></div><div class="line">      <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">      /&gt;</div><div class="line">  <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">      <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></div><div class="line">      <span class="attr">android:text</span>=<span class="string">"@&#123;user.age&#125;"</span></div><div class="line">      <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">      /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>再写一个 RecyclerViewAdapter：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RecyclerViewAdapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">DataBoundViewHolder</span>&lt;<span class="title">ItemRvBinding</span>&gt;&gt; </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> List&lt;User&gt; users;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">RecyclerViewAdapter</span><span class="params">(List&lt;User&gt; users)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.users = users;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> DataBoundViewHolder&lt;ItemRvBinding&gt; <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</div><div class="line">    ItemRvBinding binding = ItemRvBinding.inflate(LayoutInflater.from(parent.getContext()), parent, <span class="keyword">false</span>);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DataBoundViewHolder&lt;&gt;(binding);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(DataBoundViewHolder&lt;ItemRvBinding&gt; holder, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">    holder.getBinding().setUser(users.get(position));</div><div class="line">    holder.getBinding().executePendingBindings();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> users == <span class="keyword">null</span> ? <span class="number">0</span> : users.size();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后在 Activity 或 Fragment 中生成的 RecyclerView 的实例传入这个 adapter，用法和没有使用 Data Binding 一样，这就是简单地把数据绑定到 RecyclerView 并显示出来。ListView 使用 Data Binding 也类似以上的写法，Data Binding 只是使 adapter 绑定 item view 更方便。  </p>
<h2 id="表达式"><a href="#表达式" class="headerlink" title="表达式"></a>表达式</h2><ul>
<li>数学运算 + - / * %  </li>
<li>字符串连接 +  </li>
<li>逻辑 &amp;&amp; ||  </li>
<li>二元 &amp; | ^  </li>
<li>一元 + - ! ~  </li>
<li>移位 &gt;&gt; &gt;&gt;&gt; &lt;&lt;  </li>
<li>比较== &gt; &lt; &gt;= &lt;=  </li>
<li>instanceof  </li>
<li>Grouping ()  </li>
<li>字面 character, String, numeric, null  </li>
<li>Cast  </li>
<li>调用方法  </li>
<li>访问 field  </li>
<li>访问数组  </li>
<li>三元 ?:  </li>
</ul>
<p>示例：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">android:text="@&#123;String.valueOf(index + 1)&#125;"</div><div class="line">android:visibility="@&#123;age <span class="tag">&lt; <span class="attr">13</span> ? <span class="attr">View.GONE</span> <span class="attr">:</span> <span class="attr">View.VISIBLE</span>&#125;"</span></div><div class="line"><span class="attr">android:transitionName</span>=<span class="string">'@&#123;"image_" + id&#125;'</span></div></pre></td></tr></table></figure></p>
<h2 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a>Attributes</h2><p>在 xml 中我们会用到控件的很多 attribute(属性)，假如需要在 java 代码中写很多 setter，例如 setText(), setBackgroundColor() 等等，这会增加代码量，不好复用，比如 TextView 的 setText() 方法在调用前需要很多逻辑处理传入的字符串，而这个逻辑处理在两个完全不同的 Activity 中不同的 TextView 的 setText() 方法都用到了，虽然可以把这个逻辑写到一个共用的类中(例如 Utils)，但是我觉得这不够优雅。Data Binding 可以把种情况写得相对比较优雅一点，因为 <code>@BindingAdapter</code>, <code>@BindingConversion</code>, 有了这两个 annotation 之后将减少可观的代码量，也会使代码更容易维护。<br>下面举例：<br>User 这个类的 name 在赋值到一个 TextView 之前需要做一些处理，例如判空或其他复杂逻辑处理，然后又不想写一大块的 setText() 代码，虽然有了 Data Binding 也不可能直接把逻辑写到 xml 里面去，否则会造成 xml 可读性变差，也不好调试问题，这时候可以使用 <code>@BindingAdapter</code>。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@BindingAdapter</span>(<span class="string">"name"</span>)</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setUserName</span><span class="params">(TextView tv, String name)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(name == <span class="keyword">null</span>) <span class="keyword">return</span>;</div><div class="line">    tv.setText(name);</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>这就会生成一个 namespace 为 name 的 attribute 了，这里包含了一个判空逻辑，这样处理的好处我认为是，如果赋值为空就不需要调用 setText() 方法了，而且如果赋值为空 Data Binding 也会自动避免空指针，赋值 null，要知道 TextView 每次 setText() 都会触发 requestLayout(), 假如是在一个需要频繁处理文本的地方 setText(null)，这可能会造成多次绘制从而 overdraw。直接在 TextView 这样使用：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">      <span class="attr">app:name</span>=<span class="string">"@&#123;user.name&#125;"</span></div><div class="line">      /&gt;</div></pre></td></tr></table></figure></p>
<p>如果你想在 xml 里面做字符串格式处理，例如：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">      <span class="attr">app:name</span>=<span class="string">"@&#123;@string/name(user.name)&#125;"</span></div><div class="line">      /&gt;</div></pre></td></tr></table></figure></p>
<p>直接引用字符串资源就行了，遗憾的是，目前并未支持字符串资源智能提示，而且在 xml 里也不能直接跳转目标字符串，修改的话需要手动去 strings.xml 查找。</p>
<p>TextView 是不能直接显示一个 double 类型的值的，虽然可以先在 java 代码里面转换成字符串再赋值，但是如果要复用这个转换呢？而且如果需要对这个 double 值约小数位呢？这时候 <code>@BindingConversion</code> 派上用场了。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@BindingConversion</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">displayMoney</span><span class="params">(<span class="keyword">double</span> money)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> String.format(<span class="string">"%.2f"</span>, money);</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>这样， TextView 显示的就是约两位小数的字符串了，直接在 xml 这样写：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">      <span class="attr">android:text</span>=<span class="string">"@&#123;user.money&#125;"</span></div><div class="line">      /&gt;</div></pre></td></tr></table></figure></p>
<p>无需特定的 attribute，直接赋值。</p>


                
            </div>

            <!-- Comments -->
            
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    


                </div>
            
        </div>
    </div>
</article>

    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    

                    

                    
                        <li>
                            <a href="https://github.com/chowaikong" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    

                    
                </ul>
                <p class="copyright text-muted">Original Theme <a target="_blank" href="http://startbootstrap.com/template-overviews/clean-blog/">Clean Blog</a> from <a href="http://startbootstrap.com/" target="_blank">Start Bootstrap</a></p>
                <p class="copyright text-muted">Adapted for <a target="_blank" href="https://hexo.io/">Hexo</a> by <a href="http://www.codeblocq.com/" target="_blank">Jonathan Klughertz</a></p>
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Bootstrap -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->



</body>

</html>